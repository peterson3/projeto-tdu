--DO NOT EDIT THIS FILE BY HAND - EACH LINE (EVEN BLANK) ARE IMPORTANT

--CONNECTION AND CONFIG
conn OWNER/SENHA@BANCO

clear scr
SET ECHO OFF
SET DEFINE OFF
SET SERVEROUTPUT ON
SET FEEDBACK ON
SET TIMING OFF
SET PAGESIZE 5000
SET LINESIZE 200

--VARIABLE SPOOL LOG ADDRESS/FILENAME.EXT
spool K:\Pacotes\51901-51950\51901-FELIPE\SEG_DES8_TESTE.log

PROMPT ### CONECTADO COMO
SHOW USER

PROMPT ### NOME DO BANCO
SELECT UPPER(INSTANCE_NAME) NOME_DO_BANCO FROM V$INSTANCE;

PROMPT ### DATA
select to_char(sysdate,'dd/mm/yyyy HH24:MI:SS') DATA from dual;

spool off

--VARIABLE SPOOL INVALID OBJECTS BEFORE ADDRESS/FILENAME.EXT
spool K:\Pacotes\51901-51950\51901-FELIPE\ObjetosInvalidosAntes(SEG_DES8_TESTE).log

set echo off

PROMPT ### OBJETOS INVÁLIDOS ANTES DA COMPILAÇÃO
SELECT owner, object_type, count(*)
FROM dba_objects
WHERE status != 'VALID' 
AND OBJECT_TYPE != 'JAVA CLASS'
AND OBJECT_TYPE != 'SYNONYM' 
AND OBJECT_TYPE != 'JAVA SOURCE'
AND owner != 'TS_TESTE'
AND owner like 'TS%'
group by owner, object_type
order by owner, object_type;

PROMPT ##NOME DOS OBJETOS INVALIDOS ANTES
select owner, object_type, object_name from dba_objects 
WHERE status != 'VALID' 
AND OBJECT_TYPE != 'JAVA CLASS'
AND OBJECT_TYPE != 'SYNONYM' 
AND OBJECT_TYPE != 'JAVA SOURCE'
AND owner != 'TS_TESTE'
AND owner like 'TS%'
order by owner, object_type, object_name;

spool off

--VARIABLE SPOOL LOG APPEND ADDRESS/FILENAME.EXT
spool K:\Pacotes\51901-51950\51901-FELIPE\SEG_DES8_TESTE.log APPEND

PROMPT ======================
PROMPT  APLICANDO OS OBJETOS
PROMPT ======================
PROMPT

--VARIABLE OBJECTS TO BE APPLIED
@K:\Pacotes\51901-51950\51901-FELIPE\Packages\ts.AT_MOVIMENTACAO_PEDIDO_ddl.SQL

PROMPT ##COMPILANDO... 
SET TIMING ON

PROMPT ### COMPILANDO TS
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS');
PROMPT ### COMPILANDO TS_ODO
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_ODO');
PROMPT ### COMPILANDO TS_ARQ
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_ARQ');
PROMPT ### COMPILANDO TS_AUD
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_AUD');
PROMPT ### COMPILANDO TS_HIST
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_HIST');
PROMPT ### COMPILANDO TS_MEDLINK
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_MEDLINK');
PROMPT ### COMPILANDO TS_METLIFE
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_METLIFE');
PROMPT ### COMPILANDO TS_MON
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_MON');
PROMPT ### COMPILANDO TS_REDE_ANS
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_REDE_ANS');
PROMPT ### COMPILANDO TS_SEC
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_SEC');
PROMPT ### COMPILANDO TS_SEG
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_SEG');
PROMPT ### COMPILANDO TS_SEP
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_SEP');
PROMPT ### COMPILANDO TS_SISTEMA
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_SISTEMA');
PROMPT ### COMPILANDO TS_TOP
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_TOP');
PROMPT ### COMPILANDO TS_UNI_ODO
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_UNI_ODO');
PROMPT ### COMPILANDO TS_VW
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_VW');
PROMPT ### COMPILANDO TS_WORKLOAD
EXECUTE SYS.UTL_RECOMP.RECOMP_SERIAL('TS_WORKLOAD');

SET TIMING OFF

spool off

--VARIABLE SPOOL INVALID OBJECTS AFTER ADDRESS/FILENAME.EXT
spool K:\Pacotes\51901-51950\51901-FELIPE\ObjetosInvalidosDepois(SEG_DES8_TESTE).log

set echo off

PROMPT ##QUANTIDADE DE OBJETOS INVALIDOS DEPOIS
SELECT owner, object_type, count(*)
FROM dba_objects
WHERE status != 'VALID' 
AND OBJECT_TYPE != 'JAVA CLASS'
AND OBJECT_TYPE != 'SYNONYM' 
AND OBJECT_TYPE != 'JAVA SOURCE'
AND owner != 'TS_TESTE'
AND owner like 'TS%'
group by owner, object_type
order by owner, object_type;

PROMPT ##NOME DOS OBJETOS INVALIDOS DEPOIS
select owner, object_type, object_name from dba_objects 
WHERE status != 'VALID' 
AND OBJECT_TYPE != 'JAVA CLASS'
AND OBJECT_TYPE != 'SYNONYM' 
AND OBJECT_TYPE != 'JAVA SOURCE'
AND owner != 'TS_TESTE'
AND owner like 'TS%'
order by owner, object_type, object_name;

spool off